<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Confirmation - StyleHub</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../../styles/style.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Navbar -->
    <header class="sticky-top bg-white shadow-sm">
      <nav class="navbar navbar-expand container d-flex align-items-center">
        <button class="btn btn-lg me-3" onclick="history.back()">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
        <a class="navbar-brand fw-bold fs-3 d-flex align-items-center" href="/">
          <span class="nice_text">Style</span>
          <i class="fa-solid fa-tshirt ms-1 nice_text"></i>
          <span class="text-dark">Hub</span>
        </a>
      </nav>
    </header>

    <!-- Confirmation Section -->
    <section class="py-5">
      <div class="container text-center">
        <h2 class="mb-3 text-success">Thank you for your order!</h2>
        <p>Your order has been placed successfully.</p>
        <h5 class="fw-bold">Order Number: <span id="orderNumber"></span></h5>

        <div class="card mt-4 p-4 shadow-sm">
          <h5 class="mb-3">Order Summary</h5>
          <div id="order-items"></div>
          <hr />
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <span id="summary-subtotal">$0.00</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping:</span>
            <span id="summary-shipping">$0.00</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Tax (5%):</span>
            <span id="summary-tax">$0.00</span>
          </div>
          <div class="d-flex justify-content-between fw-bold">
            <span>Total:</span>
            <span id="summary-total">$0.00</span>
          </div>
        </div>

        <div class="mt-4">
          <a href="/" class="btn add_to_cart">Continue Shopping</a>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const lastOrder = JSON.parse(localStorage.getItem("lastOrder"));
        if (!lastOrder || !lastOrder.items || lastOrder.items.length === 0) {
          document.body.innerHTML =
            "<div class='container text-center py-5'><h3>No recent order found.</h3><a href='/' class='btn btn-primary mt-3'>Back to Shop</a></div>";
          return;
        }

        // Set order number
        document.getElementById("orderNumber").textContent =
          lastOrder.orderNumber || Math.floor(Math.random() * 1000000);

        // Show items
        const itemsContainer = document.getElementById("order-items");
        let subtotal = 0;
        itemsContainer.innerHTML = lastOrder.items
          .map((item) => {
            const itemTotal = Number(item.price) * Number(item.qty);
            subtotal += itemTotal;
            return `
              <div class="d-flex justify-content-between align-items-start pb-2 mb-2 border-bottom">
                <div>
                  <strong class="d-block text-wrap">${item.title}</strong>
                  <div class="text-start">
                    <small class="text-muted">Qty: ${item.qty}</small>
                  </div>
                </div>
                <span class="fw-bold">$${itemTotal.toFixed(2)}</span>
              </div>
            `;
          })
          .join("");

        // Use the saved shipping fee from checkout
        const shipping = lastOrder.shipping || 0;

        // Tax (5%)
        const tax = subtotal * 0.05;

        // Total
        const total = subtotal + shipping + tax;

        // Update summary
        document.getElementById("summary-subtotal").textContent =
          "$" + subtotal.toFixed(2);
        document.getElementById("summary-shipping").textContent =
          "$" + shipping.toFixed(2);
        document.getElementById("summary-tax").textContent =
          "$" + tax.toFixed(2);
        document.getElementById("summary-total").textContent =
          "$" + total.toFixed(2);
      });
    </script>
  </body>
</html>
